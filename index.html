<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡ªå®…ã‚«ãƒ¡ãƒ©ãƒ»ãƒªãƒ¢ã‚³ãƒ³</title>
    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 20px; background-color: #f0f2f5; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1 { color: #1a73e8; font-size: 1.5rem; }
        button { 
            width: 100%; padding: 15px; font-size: 1.2rem; font-weight: bold;
            border: none; border-radius: 8px; cursor: pointer; margin: 10px 0;
            transition: opacity 0.2s;
        }
        #startBtn { background-color: #34a853; color: white; }
        #stopBtn { background-color: #ea4335; color: white; }
        button:active { opacity: 0.7; }
        #status { margin: 20px 0; padding: 10px; border-radius: 5px; background: #eee; font-size: 0.9rem; }
        #linkArea { margin-top: 30px; }
        .view-link { 
            display: inline-block; padding: 20px; background: #1a73e8; color: white; 
            text-decoration: none; border-radius: 10px; font-weight: bold; animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸ  è‡ªå®…ã‚«ãƒ¡ãƒ©ãƒ»ãƒªãƒ¢ã‚³ãƒ³</h1>
    
    <div id="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æ¥ç¶šä¸­...</div>

    <button id="startBtn">ã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã™ã‚‹</button>
    <button id="stopBtn">ã‚«ãƒ¡ãƒ©ã‚’åœæ­¢ã™ã‚‹</button>

    <div id="linkArea">
        </div>
</div>

<script>
    // --- è¨­å®š (è‡ªå®…PCã® Node.js å´ã¨åˆã‚ã›ã¦ãã ã•ã„) ---
    const BROKER = 'wss://broker.emqx.io:8084/mqtt';
    const TOPIC_CONTROL = 'rnubnxuhbtdjsm-un-siewuchtus-2026/nudjx'; // æŒ‡ä»¤ã‚’é€ã‚‹ãƒˆãƒ”ãƒƒã‚¯
    const TOPIC_URL = 'myhome/cam/url_info';    // URLã‚’å—ã‘å–ã‚‹ãƒˆãƒ”ãƒƒã‚¯

    // MQTTæ¥ç¶š
    const client = mqtt.connect(BROKER);

    const statusEl = document.getElementById('status');
    const linkArea = document.getElementById('linkArea');

    client.on('connect', () => {
        statusEl.innerText = 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æ¥ç¶šå®Œäº†ï¼ˆæº–å‚™OKï¼‰';
        statusEl.style.background = '#e6f4ea';
        client.subscribe(TOPIC_URL);
    });

    client.on('error', (err) => {
        statusEl.innerText = 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: æ¥ç¶šã‚¨ãƒ©ãƒ¼';
        statusEl.style.background = '#fce8e6';
    });

    // ã€Œèµ·å‹•ã€ãƒœã‚¿ãƒ³
    document.getElementById('startBtn').onclick = () => {
        linkArea.innerHTML = 'URLç™ºè¡Œã‚’å¾…ã£ã¦ã„ã¾ã™...';
        client.publish(TOPIC_CONTROL, 'START_CAMERA');
    };

    // ã€Œåœæ­¢ã€ãƒœã‚¿ãƒ³
    document.getElementById('stopBtn').onclick = () => {
        linkArea.innerHTML = '';
        client.publish(TOPIC_CONTROL, 'STOP_CAMERA');
        statusEl.innerText = 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åœæ­¢å‘½ä»¤ã‚’é€ä¿¡ã—ã¾ã—ãŸ';
    };

    // URLã‚’å—ä¿¡ã—ãŸã¨ã
    client.on('message', (topic, message) => {
        if (topic === TOPIC_URL) {
            const url = message.toString();
            statusEl.innerText = 'ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: é…ä¿¡ä¸­ï¼';
            linkArea.innerHTML = `
                <p>æ˜ åƒã®æº–å‚™ãŒã§ãã¾ã—ãŸï¼š</p>
                <a href="${url}" target="_blank" class="view-link">ğŸ”´ æ˜ åƒã‚’è¦‹ã‚‹ï¼ˆåˆ¥ã‚¿ãƒ–ï¼‰</a>
            `;
        }
    });
</script>

</body>
</html>
